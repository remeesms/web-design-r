zkex.grid.Group=zk.$extends(zul.grid.Row,{_open:true,$define:{open:function(a){this._openItem(a,true);if(a&&this.parent){this.parent.stripe()}}},getItems:function(){var b=[];for(var a=this.nextSibling;a&&!a.$instanceof(zkex.grid.Group);a=a.nextSibling){b.push(a)}return b},getItemCount:function(){return this.getItems().length},getZclass:function(){return this._zclass!=null?this._zclass:"z-group"},getLabel:function(){return this.firstChild!=null&&this.firstChild.$instanceof(zul.wgt.Label)?this.firstChild.getValue():null},domImage_:function(){var a=this.getZclass();return'<span id="'+this.uuid+'-img" class="'+a+"-img "+a+"-img-"+(this._open?"open":"close")+'"></span>'},domContent_:function(){var b=this.getLabel(),a=this.domImage_();return b?a+" ":a},isStripeable_:function(){return false},encloseChildHTML_:function(c){var b=c.out||[],d=c.child,a=d.$instanceof(zul.wgt.Cell);if(!a){b.push('<td id="',d.uuid,'-chdextr"',this._childAttrs(d,c.index),">",'<div id="',d.uuid,'-cell" class="',c.zclass,"-cnt ",c.cls,'">');if(d==this.firstChild){b.push(this.domContent_())}}d.redraw(b);if(!a){b.push("</div></td>")}if(!c.out){return b.join("")}},_doImgClick:function(a){var b=!this.isOpen(),c=this.getGrid();if(!b){zWatch.fireDown("onHide",this.parent)}this._openItem(b);if(b||c.getModel()){if(b){this.parent.stripe()}if(!c.paging){c.onSize()}}if(b){zUtl.fireShown(this.parent)}a.stop()},_openItem:function(e,d){this._open=e;var c=this.$n("img"),g=this.getZclass();if(c){jq(c)[e?"removeClass":"addClass"](g+"-img-close")[e?"addClass":"removeClass"](g+"-img-open")}var f=this.getGrid(),b=f?f.inPagingMold():false,a=f?f.isModel():false;if(!b){this._openItemNow(e)}if(!d){this.fire("onOpen",{open:e},{toServer:b||a||f._grid$rod})}},_openItemNow:function(b){var a=this.$n();if(a){for(var c,a=a.nextSibling;a&&(c=zk.Widget.$(a))&&!zkex.grid.Group.isInstance(c)&&!zkex.grid.Groupfoot.isInstance(c);a=a.nextSibling){if(c.desktop&&c.isVisible()){jq(a)[b?"show":"hide"]()}}}},beforeParentChanged_:function(e){if(!e){var d=this.parent,b=d.hasGroup();if(b){for(var a=d.getGroups(),f=d.getGroupCount();--f>=0;){if(a[f]==this){b=a[--f];break}}}if(b){this._unbindafter=[function(){if(b){b._openItem(b.isOpen(),true)}}]}else{this._openItemNow(true,true)}}this.$supers("beforeParentChanged_",arguments)},onChildAdded_:function(a){this.$supers("onChildAdded_",arguments);if(this.firstChild==a){this.rerender()}},bind_:function(){this.$supers(zkex.grid.Group,"bind_",arguments);var g=this.$n(),a,e=g.parentNode.parentNode;if(a=this.$n("img")){this.domListen_(a,"onClick","_doImgClick")}if(!this._spans&&e.tBodies.length>1){var d=0;for(var f=e.rows[0],c=f.cells.length;c--;){if(zk(f.cells[c]).isVisible()){d++}}for(var b=g.cells,c=b.length;c--;){d-=b[c].colSpan}if(d>0&&g.cells.length){g.cells[g.cells.length-1].colSpan+=d}}},unbind_:function(c,b){var a;if(a=this.$n("img")){this.domUnlisten_(a,"onClick","_doImgClick")}if(this._unbindafter&&this._unbindafter.length){b.push(this._unbindafter.pop())}this._unbindafter=null;this.$supers(zkex.grid.Group,"unbind_",arguments)}});