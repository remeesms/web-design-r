(function(){function d(m,l,i){var o=m.control,k=o.getNewColor(),j=m.node,n=zk(o.$n("bar")).revisedOffset(),p=l[1]-n[1];j.style.top=jq.px(p);k.setHSV((256-p)*359.99/255,k.getSaturation(),k.getValue());o._colorChanged("arrows");return false}function g(l,k){var j=0,i=255,m=k[1];m=m<j?j:m>i?i:m;return[k[0],m]}function c(m,l,i){var n=m.control,k=n._newColor,j=n.$n("arrows"),o=zk.parseInt(j.style.top);k.setHSV((256-o)*359.99/255,k.getSaturation(),k.getValue());n._colorChanged("arrows")}function b(o,s,q){var r=o.control,m=r.getNewColor(),l=zk(r.$n("overlay")).revisedOffset(),k=o.node,p=s[0]-l[0],n=s[1]-l[1],j=p/255,i=1-n/255;k.style.left=jq.px(p);k.style.top=jq.px(n);m.setHSV(m.getHue(),j,i);r._colorChanged();return false}function f(m,l){var k=0,j=255,i=l[0],n=l[1];i=i<k?k:i>j?j:i;n=n<k?k:n>j?j:n;return[i,n]}function h(n,r,p){var q=n.control,l=q._newColor,k=q.$n("circle"),o=zk.parseInt(k.style.left),m=zk.parseInt(k.style.top),j=o/255,i=1-(m/255);l.setHSV(l.getHue(),j,i);q._colorChanged()}function a(l){var i=l.$n("overlay");if(zk.ie6_&&!i.style.filter){var k=zk.ajaxURI("/web/zkex/img/colorbox/colorpicker_gradient.png",{au:true}),j='progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, src="'+k+'" sizingMethod=scale)';i.style.background=i.style.backgroundImage="none";i.style.filter=j}}var e=zkex.inp.PickerPop=zk.$extends(zk.Widget,{_inpChanged:false,$init:function(i){this.$supers("$init",arguments);this._currColor=new zkex.inp.Color();this._newColor=new zkex.inp.Color();this._wgt=i._wgt},$define:{color:function(i){this._currColor.setHex(i);this._newColor.setHex(i)}},getNewColor:function(){return this._newColor},getZclass:function(){return"z-colorpicker"},redraw:function(k){var m=this.getZclass(),l=this.uuid,i=zk.ajaxURI("/web/zkex/img/colorbox/accept.gif",{au:true}),j=zk.ajaxURI("/web/zkex/img/colorbox/cancel.gif",{au:true});k.push("<div",this.domAttrs_(),">",'<div id="',l,'-gradient" class="',m,'-gradient">','<div id="',l,'-overlay" class="',m,'-overlay"></div>','<div id="',l,'-circle" class="',m,'-circle"></div></div>','<div id="',l,'-hue" class="',m,'-hue">','<div id="',l,'-bar" class="',m,'-bar"></div>','<div id="',l,'-arrows" class="',m,'-arrows"></div></div>','<div id="',l,'-color" class="',m,'-color">','<div id="',l,'-newcolor" class="',m,'-newcolor"></div>','<div id="',l,'-currcolor" class="',m,'-currcolor"></div></div>','<div id="',l,'-hex" class="',m,'-hex" >','<label id="',l,'-hex-text" class="',m,'-hex-text">Hex:</label>','<input id="',l,'-hex-inp" class="',m,'-hex-inp" type="text" size="8" maxlength="7"></input></div>','<div id="',l,'-r" class="',m+"-r",'">','<label id="',l,'-r-text" class="',m,'-r-text">R.</label>','<input id="',l,'-r-inp" class="',m,'-r-inp" type="text" size="3" maxlength="3"></input></div>','<div id="',l,'-g" class="',m,'-g">','<label id="',l,'-g-text" class="',m,'-g-text">G.</label>','<input id="',l,'-g-inp" class="',m,'-g-inp" type="text" size="3" maxlength="3"></input></div>','<div id="',l,'-b" class="',m,'-b">','<label id="',l,'-b-text" class="',m,'-b-text">B.</label>','<input id="',l,'-b-inp" class="',m,'-b-inp" type="text" size="3" maxlength="3"></input></div>','<div id="',l,'-h" class="',m,'-h">','<label id="',l,'-h-text" class="',m,'-h-text">H.</label>','<input id="',l,'-h-inp" class="',m,'-h-inp" type="text" size="3" maxlength="3"></input></div>','<div id="',l,'-s" class="',m,'-s">','<label id="',l,'-s-text" class="',m,'-s-text">S.</label>','<input id="',l,'-s-inp" class="',m,'-s-inp" type="text" size="3" maxlength="3"></input></div>','<div id="',l,'-v" class="',m,'-v">','<label id="',l,'-v-text" class="',m,'-v-text">V.</label>','<input id="',l,'-v-inp" class="',m,'-v-inp" type="text" size="3" maxlength="3"></input></div>','<button type="button" id="',l,'-ok-btn" class="',m,'-ok-btn"><img src="',i,'"></img></button>',"</div>")},bind_:function(){this.$supers(e,"bind_",arguments);var k=this.$n("arrows"),i=this.$n("hue"),j=this.$n("circle"),l=this.$n("gradient");this._arrowsDrag=new zk.Draggable(this,k,{constraint:"vertical",handle:i,ignoredrag:d,snap:g,change:c,endeffect:zk.$void});this._circleDrag=new zk.Draggable(this,j,{handle:l,ignoredrag:b,snap:f,change:h,endeffect:zk.$void});this.domListen_(this.$n("ok-btn"),"onClick","_doOk");this.domListen_(this.$n("hex-inp"),"onBlur","_doHexChange");this.$n("r-inp")._inpSrc="R";this.$n("g-inp")._inpSrc="G";this.$n("b-inp")._inpSrc="B";this.$n("h-inp")._inpSrc="H";this.$n("s-inp")._inpSrc="S";this.$n("v-inp")._inpSrc="V";zWatch.listen({onShow:this,onFloatUp:this,onHide:this})},unbind_:function(){if(this._arrowsDrag){this._arrowsDrag.destroy();this._arrowsDrag=null}if(this._circleDrag){this._circleDrag.destroy();this._circleDrag=null}this.domUnlisten_(this.$n("ok-btn"),"onClick","_doOk");this.domUnlisten_(this.$n("hex-inp"),"onBlur","_doHexChange");this.$n("r-inp")._inpSrc=this.$n("g-inp")._inpSrc=this.$n("b-inp")._inpSrc=this.$n("h-inp")._inpSrc=this.$n("s-inp")._inpSrc=this.$n("v-inp")._inpSrc=null;zWatch.unlisten({onShow:this,onFloatUp:this,onHide:this});this.$supers(e,"unbind_",arguments)},onHide:function(){this._wgt.onHide()},onFloatUp:function(i){if(!zUtl.isAncestor(this.parent,i.origin)){this._wgt.onHide()}},onShow:function(){a(this);this._colorChanged("onShow")},_doHexChange:function(){this._newColor.setHex(this.$n("hex-inp").value);this._colorChanged("inp")},_colorChanged:function(i){var r=this._newColor,q=r.getHue(),l=r.getSaturation(),k=r.getValue(),m=r.getHex(),s=r.getRGB();this.$n("r-inp").value=s[0];this.$n("g-inp").value=s[1];this.$n("b-inp").value=s[2];this.$n("hex-inp").value=m;this.$n("h-inp").value=Math.round(q);this.$n("s-inp").value=Math.round(l*100);this.$n("v-inp").value=Math.round(k*100);if(i=="arrows"||i=="inp"||i=="onShow"){var o=new zkex.inp.Color();o.setHSV(q,1,1);this.$n("overlay").style.backgroundColor=o.getHex()}if(i=="inp"||i=="onShow"){var j=this.$n("arrows"),p=(256-q*255/359.99),v=p<0?0:p>255?255:p,n=this.$n("circle"),u=l*255,t=(1-k)*255;j.style.top=jq.px(v);n.style.top=jq.px(t);n.style.left=jq.px(u)}if(i=="onShow"){this.$n("currcolor").style.backgroundColor=this._currColor.getHex()}this.$n("newcolor").style.backgroundColor=m},_doInpChanged:function(i){if(!this._inpChanged||i.domTarget==this.$n("hex-inp")){return}var n=i.domTarget,l=this._newColor,m=l.getRGB(),k=l.getHue(),j=l.getSaturation(),o=l.getValue(),p=zk.parseInt(n.value);switch(n._inpSrc){case"R":l.setRGB(p,m[1],m[2]);break;case"G":l.setRGB(m[0],p,m[2]);break;case"B":l.setRGB(m[0],m[1],p);break;case"H":l.setHSV(p,j,o);break;case"S":l.setHSV(k,p/100,o);break;case"V":l.setHSV(k,j,p/100);break}this._colorChanged("inp");this._inpChanged=false},doKeyDown_:function(i){var l=i.keyCode,k=i.domTarget,j=this.$n("hex-inp");switch(l){case 48:case 96:case 49:case 97:case 50:case 98:case 51:case 99:case 52:case 100:case 53:case 101:case 54:case 102:case 55:case 103:case 56:case 104:case 57:case 105:case 37:case 39:case 46:case 8:break;case 13:if(k==j){this._doHexChange();return}case 9:break;default:if(k==j&&"ABCDEF".indexOf(String.fromCharCode(l))>0){break}i.stop();return}this._inpChanged=true},doKeyUp_:function(i){this._doInpChanged(i)},_doOk:function(i){var j=this._wgt;j.onChange(this._newColor.getHex());j.onHide(true);i.stop()},_doCancel:function(i){this._wgt.closePicker(true);i.stop()}})})();