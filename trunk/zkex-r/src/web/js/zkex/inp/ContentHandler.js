zkex.inp.ContentHandler=zk.$extends(zk.Object,{$init:function(b,a){this.$supers("$init",arguments);this._wgt=b;this.setContent(a)},redraw:function(c){var f=this._wgt,d=f.uuid,e=f.getZclass(),b=this._picker,a=this._palette;switch(this._type){case"color":c.push('<div id="',d,'-cnt-pp" style="display:none;" class="',e,'-pp">',a?'<div id="'+d+'-palette-btn" class="'+e+'-palette-btn"></div>':"",b?'<div id="'+d+'-picker-btn" class="'+e+'-picker-btn"></div>':"");if(b){this._picker.redraw(c)}if(a){this._palette.redraw(c)}c.push("</div>");break;case"content":c.push('<div id="',d,'-cnt-pp" class="',e,'-cnt-pp" style="display:none"><div class="',e,'-cnt-body">',this._content,"</div></div>")}},bind:function(){var e=this._wgt,d=e.uuid,c=this._type;if(!e.menupopup){e.domListen_(e.$n(),"onClick","onShow");zWatch.listen({onFloatUp:e,onHide:e})}this._pp=e.$n("cnt-pp");switch(c){case"color":if(!this._color){this._color=new zkex.inp.Color(this._hex)}var b=e.$n("img");if(b){b.style.backgroundColor=this._color.getHex()}var a=this;jq(e.$n("palette-btn")).bind("click",function(){a.openPalette()});jq(e.$n("picker-btn")).bind("click",function(){a.openPicker()});break;case"content":break}},unbind:function(){var b=this._wgt,a=b.uuid;if(!b.menupopup){b.domUnlisten_(b.$n(),"onClick","onShow");if(this._shadow){this._shadow.destroy();this._shadow=null}this._pp=null;switch(this._type){case"color":jq(b.$n("palette-btn")).unbind("click");jq(b.$n("picker-btn")).unbind("click");this._color=null;break;case"content":zWatch.unlisten({onFloatUp:this,onHide:this});break}}},isOpen:function(){var a=this._pp;return a&&zk(a).isVisible()},onShow:function(){this.openContent()},onHide:function(b){var a=this._pp;if(!a||!zk(a).isVisible()){return}a.style.display="none";jq(a).zk.undoVParent();this._hideShadow();if(b){zWatch.fire("onFloatUp",null)}},onFloatUp:function(a){if(!zUtl.isAncestor(this._wgt,a.origin)){this.onHide()}},onChange:function(c){var b=this._type;switch(b){case"color":var d=this._wgt,a=d.$n("img");if(a){a.style.backgroundColor=this._hex=c}this._color.setHex(c);d.fire("onChange",{color:c,value:c},{toServer:true},150);break;case"content":break}},_syncShadow:function(a){if(!this._shadow){this._shadow=new zk.eff.Shadow(this._pp,{stackup:(zk.useStackup===undefined?zk.ie6_:zk.useStackup)})}this._shadow.sync()},_hideShadow:function(a){this._shadow.hide()},setContent:function(e){if(!e||this._wgt.menupopup){return}this._content=e;var f=this._type,b=this._getType(e),g=this._wgt;if(f!=b){this.destroy()}this._type=b;switch(b){case"color":var d=e.substr(e.indexOf("#color")+"#color".length+1);if(!this._color){this._color=new zkex.inp.Color(d);this._hex=this._color.getHex()}else{var h=this._color,a=g.$n("img");h.setHex(d);if(a){a.style.backgroundColor=h.getHex()}}if(!this._picker&&!this._palette){this._picker=new zkex.inp.PickerPop({_wgt:this});g.appendChild(this._picker);this._palette=new zkex.inp.PalettePop({_wgt:this});g.appendChild(this._palette);g.rerender(0)}break;case"content":g.rerender();break}},destroy:function(){var c=this._type;if(!c){return}switch(c){case"color":var b=this._picker,a=this._palette,d=this._wgt;if(this._color){this._color=null}if(b&&a){d.removeChild(b);d.removeChild(a);this._picker=this._palette=this._type=this._hex=null;d.rerender()}break;case"content":this._wgt.rerender();break}},_getType:function(a){if(!a){return}if(a.indexOf("#color")==0){return"color"}else{return"content"}},openContent:function(){var a=this._pp;if(!a){return}if(this._type=="color"){this.openPalette()}a.style.width=a.style.height="auto";a.style.position="absolute";a.style.overflow="auto";a.style.display="block";a.style.zIndex="88000";jq(a).zk.makeVParent();zk(a).position(this._wgt.$n(),this.getPosition());this._syncShadow()},openPalette:function(){var d=this._wgt.$n(),b=this._palette.$n();if(!d||!b){return}var c=this._picker.$n();if(c&&zk(c).isVisible()){this.closePicker()}b.style.display="block";jq(this._wgt.$n("cnt-pp")).addClass("z-palette-btn");this._syncShadow();var a=this._palette;a.setColor(this._color.getHex());a.onShow()},closePalette:function(b){var a=this._palette.$n();if(!a||!zk(a).isVisible()){return}a.style.display="none";jq(this._wgt.$n("cnt-pp")).removeClass("z-palette-btn");if(b){zWatch.fire("onFloatUp",null)}},openPicker:function(){var d=this._wgt,c=d.$n(),a=this._picker.$n();if(!c||!a){return}this.closePalette();a.style.display="block";jq(this._wgt.$n("cnt-pp")).addClass("z-picker-btn");this._syncShadow();var b=this._picker;b.setColor(this._color.getHex());b.onShow()},closePicker:function(b){var a=this._picker.$n();if(!a||!zk(a).isVisible()){return}a.style.display="none";jq(this._wgt.$n("cnt-pp")).removeClass("z-picker-btn");if(b){zWatch.fire("onFloatUp",null)}},getPosition:function(){var b=this._wgt;if(b.isTopmost()){var a=b.getMenubar();if(a){return"vertical"==a.getOrient()?"end_before":"after_start"}}return"end_before"}});