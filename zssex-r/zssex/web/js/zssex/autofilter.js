(function(){var e={},b={},a={},d={},c={};zk.override(zss.Spreadsheet.prototype,e,{setAutoFilter:function(k){var l=this.sheetCtrl;if(l){var n=k?k.range.top:this._autoFilter?this._autoFilter.range.top:-1,i=k?k.range.left:this._autoFilter?this._autoFilter.range.left:-1,g=n>=0?l.getRow(n,i):null;this._autoFilter=k;if(g){for(var h=0,f=g.length;h<f;++h){var m=g[h];if(m){m.prepareFilterBtns_()}else{break}}}}else{this._autoFilter=k}},getAutoFilter:function(){return this._autoFilter},setAutoFilterPopup:function(f){var g=this.sheetCtrl;if(g){g.openAutoFilterPopup_(f)}},setDataValidations:function(i){var h=this.sheetCtrl;if(h){var f=(i?i.length:0);for(var g=0;g<f;++g){this._setDataValidation(i[g],g)}this._dataValidations=i}},getDataValidations:function(){return this._dataValidations},_clearDataValidations:function(){var h=this.sheetCtrl,i=this._dataValidations;if(h){var f=(i?i.length:0);for(var g=0;g<f;++g){this._clearDataValidation(i[g])}this._dataValidations=null}},_clearDataValidation:function(k){if(k.showButton){var g=k.rangeList,f=(g?g.length:0);for(var i=0;i<f;++i){var h=g[i];this._clearValidateBtns(h)}}if(k.showPrompt){var m=k.promptTitle,l=k.promptText}},_setDataValidation:function(l,k){if(l.showButton){var g=l.rangeList,f=(g?g.length:0);for(var i=0;i<f;++i){var h=g[i];this._prepareValidateBtns(k,h)}}if(l.showPrompt){this.sheetCtrl.addValidationPromptPopup_(k,l.promptTitle,l.promptText)}if(l.validationList){this.sheetCtrl.addValidatePopup_(k,l.validationList)}},_clearValidateBtns:function(i){var g=i.left,f=i.right,p=i.top,o=i.bottom,m=this.sheetCtrl;for(var q=p;q<=o;++q){rowobjs=m.getRow(q,col);if(rowobjs){for(var h=0,k=rowobjs.length;h<k;++h){var n=rowobjs[h];if(n){n.cleanvbtns()}else{break}}}}},_prepareValidateBtns:function(g,m){var i=m.left,f=m.right,s=m.top,q=m.bottom,o=this.sheetCtrl;for(var u=s;u<=q;++u){for(var h=i;h<=f;++h){rowobjs=o.getRow(u,h);if(rowobjs){for(var k=0,n=rowobjs.length;k<n;++k){var p=rowobjs[k];if(p){p.prepareValidateBtns_(g,h)}else{break}}}}}}});zk.override(zss.DataPanel.prototype,c,{moveFocus:function(k,g,f,h,j,i){c.moveFocus.apply(this,arguments);this.showValidateBtn_(k,g)},showValidateBtn_:function(n,k){var l=this.sheet;l.cleanValidateBtns_();rowobjs=l.getRow(n,k);if(rowobjs){for(var i=0,g=rowobjs.length;i<g;++i){var m=rowobjs[i];if(m){var h=m.showValidateBtn_(k);if(h){l.addValidateBtn_(h);var f=l.getValidationPromptPopup_(h.field);if(f){f.open(n,k)}}}}}}});zk.override(zss.Row.prototype,b,{$init:function(f,i,h,g){b.$init.apply(this,arguments);this.btns={};this.vbtns={}},_prepareValidateBtns:function(){var s=this.sheet._wgt._dataValidations;if(s){for(var g=0,q=s.length;g<q;++g){var h=s[g];if(h&&h.showButton){var n=h.rangeList,j=(n?n.length:0);for(var o=0;o<j;++o){var p=n[o],w=this.r,v=p.top,u=p.bottom,m=p.left,f=p.right;if(w>=v&&w<=u){for(var k=m;k<=f;k++){this.prepareValidateBtns_(g,k)}}}}}}},_prepareAutoFilterBtns:function(){var f=this.sheet._wgt._autoFilter;if(f){var g=f?f.range.top:this._autoFilter?this._autoFilter.range.top:-1;if(g==this.r){this.prepareFilterBtns_()}}},bind_:function(){b.bind_.apply(this,arguments);this._prepareValidateBtns();this._prepareAutoFilterBtns()},unbind_:function(){b.unbind_.apply(this,arguments);this.cleanbtns();this.cleanvbtns()},cleanbtns:function(){if(this.btns){for(var g in this.btns){var f=this.btns[g];if(!f){break}f.cleanup()}this.btns={}}},cleanvbtns:function(){if(this.vbtns){this.vbtns={}}},getBtnAt:function(f){return this.btns["c"+f]},prepareFilterBtns_:function(){var u=this.r,s=this.$n(),q=this.sheet._wgt._autoFilter;this.cleanbtns();if(!q){return}var f=q.range,t=f.left,m=f.right,o=q.filterColumns,v=this.cells.length,k=this.cells[0].c,r=this.cells[v-1].c,g=0,j=o&&o.length>0?o[g]:null,h=null,l=true,p=null,n=null;for(var i=t;i<=m;++i){if(i<k){continue}if(i>r){break}if(j&&j.col==i){p=j.field;h=(t+p-1)==i?j.filter:n?n.filter:null;l=j.on;if(l){n=null}else{if(!n){n=j}}if(++g<o.length){j=o[g]}}else{h=null;l=true;p=i-t+1}if(l){this.btns["c"+i]=new zssex.Btn(this.sheet,u,i,s,h&&h.length>0?"zsfilter":"zsdropdown",p,"af")}}},prepareValidateBtns_:function(g,f){this.vbtns["c"+f]=g},showValidateBtn_:function(f){var h=this.r,g=this.vbtns["c"+f];if(g==null){return null}return new zssex.Btn(this.sheet,h,f,this.$n(),"zsdropdown",g,"dv")}});zk.override(zss.CellBlockCtrl.prototype,a,{getBtn:function(i,h){var g=this.sheet._wgt._autoFilter,f=g?g.range:null;if(!g||i!=f.top||h<f.left||h>f.right){return null}return this.rows[i-this.range.top].getBtnAt(h)}});zk.override(zss.SSheetCtrl.prototype,d,{_doBtndown:function(v,h,g,o){var j=this;if(j.state==zss.SSheetCtrl.NOFOCUS){j.dp.gainFocus();return}var p=j._wgt,n=(g)?g:v.domTarget,t,u=my=0,s=shy=0,m,k,l=zkS._getMouseData(v,this.comp),A="";if((t=zkS.parentByZSType(n,"SBtn",0))!=null){var w=t,B=zk(j.comp).revisedOffset(),y=zk(w).revisedOffset();u=v.pageX;my=v.pageY;s=Math.round(u-B[0]);shy=Math.round(my-B[1]);var q=u-y[0],r=zss.SSheetCtrl._calCellPos(j,u,my,false);m=r[0];k=r[1];A="c_"+m+"_"+k;if("dv"==h){k-=1;var z=o.field,f=this.getValidatePopup_(z);if(f){f.open(m,k)}}p.fireCellEvt(h,s,shy,l[2],m,k,u,my,o.field)}},_syncAutoFilterBtns:function(i,g){var f=this._wgt._autoFilter;if(f){if(i<0){i=f.range.top}if(i!=f.range.top){return}if(g<0){g=f.range.left}var h=f.range.right;for(var j=g;j<=h;++j){btn=this.getBtn(i,j);if(btn){btn.relocate(i,j)}}}},getBtn:function(j,g){var i=this.frozenRow,f=this.frozenCol,h=null;if(j<=i&&g<=f){h=this.cp.block.getBtn(j,g)}else{if(j<=i){h=this.tp.block.getBtn(j,g)}else{if(g<=f){h=this.lp.block.getBtn(j,g)}else{h=this.activeBlock.getBtn(j,g)}}}return h},_setRowHeight:function(k,f,j,g,i,h){d._setRowHeight.apply(this,arguments);this._syncAutoFilterBtns(k,-1)},_setColumnWidth:function(g,i,k,f,j,h){d._setColumnWidth.apply(this,arguments);this._syncAutoFilterBtns(-1,g)},addValidateBtn_:function(f){if(!this._vbtns){this._vbtns=[]}if(f){this._vbtns.push(f)}},cleanValidateBtns_:function(){if(this._vbtns){for(var h=0,f=this._vbtns.length;h<f;++h){var g=this._vbtns[h];g.cleanup()}this._vbtns=[]}},getValidatePopup_:function(f){if(!this._vpops){return null}return this._vpops[f]},getValidatePopup_:function(f){if(!this._vpops){return null}return this._vpops[f]},addValidatePopup_:function(g,h){if(!this._vpops){this._vpops=[]}if(h){var f=new zssex.ValidationPopup(this);this.appendChild(f,true);f.setValidationList(h);this._vpops[g]=f}},getValidationPromptPopup_:function(f){if(!this._vppops){return null}return this._vppops[f]},addValidationPromptPopup_:function(g,i,h){if(!this._vppops){this._vppops=[]}if(i||h){var f=new zssex.ValidationPromptPopup(this,i,h);this.appendChild(f,true);this._vppops[g]=f}},openAutoFilterPopup_:function(f){var h=this._autoFilterPopup;if(h){h.detach()}var g=this._autoFilterPopup=new zssex.AutoFilterPopup(this,f);this.appendChild(g,true);g.open(f.row,f.col)}})})();